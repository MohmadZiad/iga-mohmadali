<div class="statistics-layout">
    <div class="f2-card statistics-card">
        <div class="f2-card-title statistics-card-title">
            <div class="card-actions">
                <app-download-menu
                    [formats]="['csv', 'excel']"
                    (selectedFormat)="downloadReport($event)"
                />
            </div>
            <span class="f2-title-text">{{ title() }}</span>
            <div class="card-legend"></div>
        </div>

        <app-f2-table
            class="statistics-table"
            [includeIndex]="true"
            [columnOptions]="columnOptions"
            [data]="tableDate()"
            [maxDisplayingData]="5"
            variant="compact"
            (clickToRow)="onServiceSelect($event)"
        ></app-f2-table>
    </div>

    <div class="f2-card statistics-card">
        <div class="f2-card-title statistics-card-title">
            <div class="card-actions">
                <app-download-menu
                    [formats]="['csv', 'excel']"
                    (selectedFormat)="downloadReport($event)"
                />
            </div>
            <div class="card-legend chart-legend">
                <div class="legend-item">
                    <span class="legend-dot legend-dot--average"></span>
                    <span class="legend-text">متوسط</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot legend-dot--most"></span>
                    <span class="legend-text">الأكثر</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot legend-dot--fewest"></span>
                    <span class="legend-text">الأقل</span>
                </div>
            </div>
            <span class="f2-title-text">{{ title() }}</span>
        </div>

        @if (chartItems().length) {
            <div class="range-chart-scroll">
                <div class="range-chart">
                    @for (item of chartItems(); track item.service.serviceCode + '-' + item.service.accountId) {
                        <div
                            class="range-item"
                            (click)="onChartItemClick(item.service)"
                            [class.selected]="
                                selectedService()?.serviceCode === item.service.serviceCode &&
                                selectedService()?.accountId === item.service.accountId
                            "
                        >
                            <div class="range-area">
                                <div
                                    class="range-line"
                                    [style.bottom.%]="item.rangeBottomPct"
                                    [style.height.%]="item.rangeHeightPct"
                                ></div>

                                <span
                                    class="dot dot--most"
                                    [style.bottom.%]="item.mostPct"
                                    (click)="onChartItemClick(item.service)"
                                ></span>
                                <span
                                    class="dot dot--average"
                                    [style.bottom.%]="item.averagePct"
                                    (click)="onChartItemClick(item.service)"
                                ></span>
                                <span
                                    class="dot dot--fewest"
                                    [style.bottom.%]="item.fewestPct"
                                    (click)="onChartItemClick(item.service)"
                                ></span>

                                <span
                                    class="value value--most"
                                    [style.bottom.%]="item.mostPct"
                                    (click)="onChartItemClick(item.service)"
                                >
                                    {{ item.service.mostDays }}
                                </span>
                                <span
                                    class="value value--average"
                                    [style.bottom.%]="item.averagePct"
                                    (click)="onChartItemClick(item.service)"
                                >
                                    {{ item.service.averageDays }}
                                </span>
                                <span
                                    class="value value--fewest"
                                    [style.bottom.%]="item.fewestPct"
                                    (click)="onChartItemClick(item.service)"
                                >
                                    {{ item.service.fewestDays }}
                                </span>
                            </div>

                            <div class="range-label">
                                {{ item.service.serviceName }}
                            </div>
                        </div>
                    }
                </div>
            </div>
        } @else {
            <div class="empty-chart">لا توجد بيانات</div>
        }
    </div>
</div>
