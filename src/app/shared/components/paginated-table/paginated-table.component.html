<div class="search-container">
    @if (options.reload) {
        <button
            mat-icon-button
            class="mb16"
            (click)="data.refresh()"
        >
            <img
                src="assets/icons/reload.svg"
                alt="reload"
            />
        </button>
    }
    @if (options.search) {
        <input
            #search
            class="f2-input-field f2-search f2-with-reload mb16"
            type="text"
            placeholder="Search"
            (input)="data.filterBy({ search: search.value })"
        />
    }
</div>

<table
    class="table"
    [dataSource]="data"
    mat-table
>
    @for (column of options.columns; track column.property) {
        <ng-container [matColumnDef]="column.property">
            <th
                mat-header-cell
                *matHeaderCellDef
            >
                {{ column.label }}
            </th>
            <td
                [ngClass]="{ clickable: column.clickable, nowrap: column.nowrap }"
                mat-cell
                *matCellDef="let element"
                (click)="columnClicked.emit({ element, column })"
            >
                {{ formatValue(column, element[column.property]) }}
            </td>
        </ng-container>
    }

    @if (options.actions) {
        <ng-container matColumnDef="actions">
            <th
                mat-header-cell
                *matHeaderCellDef
            >
                Action
            </th>
            <td
                mat-cell
                *matCellDef="let element"
            >
                @for (action of options.actions; track action) {
                    <button
                        mat-icon-button
                        (click)="action.onClick({ element })"
                    >
                        <img
                            [src]="action.icon"
                            [alt]="action.name"
                        />
                    </button>
                }
            </td>
        </ng-container>
    }

    <tr
        class="header"
        mat-header-row
        *matHeaderRowDef="columns"
    ></tr>
    <tr
        class="row"
        mat-row
        *matRowDef="let row; columns: columns"
    ></tr>

    <tr *matNoDataRow>
        <td colspan="2">No data</td>
    </tr>
</table>
@if (options.paginator) {
    @if (data.page$ | async; as page) {
        <mat-paginator
            class="f2-paginator mt22"
            hidePageSize="true"
            [pageIndex]="page.number"
            [length]="page.totalItems"
            [pageSize]="page.size"
            (page)="pageChanged($event)"
        >
        </mat-paginator>
    }
}
